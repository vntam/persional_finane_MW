generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id           String        @id @default(uuid())
  email        String        @unique
  passwordHash String
  name         String?
  transactions Transaction[]
  budgets      Budget[]
  goals        Goal[]
  insights     AIInsight[]
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
}

model Category {
  id           String        @id @default(uuid())
  name         String
  type         CategoryType
  transactions Transaction[]
  budgets      Budget[]
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
}

model Transaction {
  id          String      @id @default(uuid())
  user        User        @relation(fields: [userId], references: [id])
  userId      String
  category    Category?   @relation(fields: [categoryId], references: [id])
  categoryId  String?
  amount      Decimal      @db.Decimal(14, 2)
  currency    String       @default("USD")
  description String?
  occurredAt  DateTime
  aiInsights  AIInsight[]
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
}

model Budget {
  id          String   @id @default(uuid())
  user        User     @relation(fields: [userId], references: [id])
  userId      String
  category    Category? @relation(fields: [categoryId], references: [id])
  categoryId  String?
  amount      Decimal   @db.Decimal(14, 2)
  period      BudgetPeriod
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
}

model Goal {
  id          String   @id @default(uuid())
  user        User     @relation(fields: [userId], references: [id])
  userId      String
  title       String
  targetAmount Decimal @db.Decimal(14, 2)
  targetDate  DateTime?
  progress    Decimal  @db.Decimal(14, 2) @default(0)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model AIInsight {
  id                   String       @id @default(uuid())
  user                 User         @relation(fields: [userId], references: [id])
  userId               String
  sourceTransaction    Transaction? @relation(fields: [sourceTransactionId], references: [id])
  sourceTransactionId  String?
  summary              String
  metadata             Json
  createdAt            DateTime     @default(now())
}

enum CategoryType {
  INCOME
  EXPENSE
  TRANSFER
}

enum BudgetPeriod {
  MONTHLY
  WEEKLY
  ANNUAL
}
